# 이벤트

### 브라우저 또는 Node.js 런타임 구조

```
🌐 Browser / Node Runtime
│
├── JS Engine (싱글 스레드)
│     ├── Call Stack
│     └── Heap
│
├── Web APIs (백그라운드 스레드)
│     ├── setTimeout / setInterval
│     ├── fetch / XMLHttpRequest
│     ├── DOM Events
│     └── I/O Threads
│
├── Task Queue (매크로태스크)
│     ├── 타이머 콜백
│     ├── I/O 완료 콜백
│     └── 메시지 이벤트 등
│
├── Microtask Queue
│     ├── Promise.then()
│     └── MutationObserver
│
└── Event Loop (조정자)
      ├── 스택이 비면 큐에서 태스크를 꺼냄
      └── 꺼낸 콜백을 다시 JS 엔진의 스택으로 push
```

### 이벤트 루프 예제

```javascript
console.log("A");

setTimeout(() => console.log("B"), 0);

Promise.resolve().then(() => console.log("C"));

console.log("D");
```

위 예제를 보고 난 실행 순서가 ADBC가 될거라고 예상했는데... 틀렸다

실제론 ADCB이며, 이유는 **이벤트 루프가 항상 마이크로태스크(microtask)를 태스크 큐(매크로태스크=이벤트큐=macrotask)보다 먼저 비우기 때문이다**
